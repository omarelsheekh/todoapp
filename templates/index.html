<html>
    <head>
        <title>TODO App</title>
    </head>
    <body>
        <form method="POST", id="form1">
            <div>
                <label>Create a Todo</label>
                <input type="text", id="description", name="description">
            </div>
            <div>
                <input type="submit", value="create">
            </div>
        </form>
        <br>
        <ul id="todos">
            {% for d in data %}
                <li><input id="todocheck-{{ d.id }}" class="checkbox-complete" type="checkbox" {% if d.completed %} checked {% endif %}>
                    {{ d.description }} 
                    <button id="todobutton-{{ d.id }}" class="cross-button">&cross;</button>
                </li>
            {% endfor %}
        </ul>
        <script>
            var crossButtons = document.getElementsByClassName('cross-button')
            for(let i=0;i<crossButtons.length;i++){
                button=crossButtons[i]
                button.onclick= function(e){
                    console.log(e)
                    fetch('/todos/'+e.target.id+'/delete',{
                        method : 'POST',
                        headers :{
                            'Content-Type' : 'application/json'
                        }
                    }).then(function(response){
                        return response.json();
                    }).then(function(jsonResponse){
                        console.log(jsonResponse);
                        document.getElementById(e.target.id).parentNode.remove()
                    }).catch(function(){
                        console.log("error happend")
                    })

                }
            }
            var checkBoxes = document.getElementsByClassName('checkbox-complete');
            for(let i=0;i<checkBoxes.length;i++){
                var checkbox=checkBoxes[i];
                checkbox.onchange = function(e){
                    console.log('event',e);
                    fetch('/todos/'+e.target.id+'/completed',{
                        method : 'POST',
                        body : JSON.stringify({
                            'completed' : e.target.checked
                        }),
                        headers :{
                            'Content-Type' : 'application/json'
                        }
                    }).then(function(response){
                        return response.json();
                    }).then(function(jsonResponse){
                        console.log(jsonResponse);
                    }).catch(function(){
                        console.log("error happend")
                    })
                }
            }
            var form1=document.getElementById('form1');
            form1.onsubmit=function(e){
                e.preventDefault();
                fetch('/todos/create',{
                    method : 'POST',
                    body : JSON.stringify({
                        'description' : document.getElementById('description').value
                    }),
                    headers :{
                        'Content-Type' : 'application/json'
                    }
                }).then(function(response){
                    return response.json();
                }).then(function(jsonResponse){
                    console.log(jsonResponse);
                    var listItem = document.createElement("li");
                    listItem.innerHTML = jsonResponse['description'];
                    document.getElementById("todos").appendChild(listItem)
                }).catch(function(){
                    console.log("error happend")
                })
            }
        </script>
    </body>
</html>